{% extends "mobile_base.html" %}

{% block title %}Schedule - MediTrack{% endblock %}

{% block content %}
<header class="app-header">
    <h1>Medication Schedule ‚è∞</h1>
    <p>Upcoming doses</p>
</header>

<div class="app-content">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Upcoming Doses</h2>
            <span class="badge badge-info">{{ schedules|length }}</span>
        </div>
        
        {% if schedules %}
        <div class="schedule-list">
            {% for schedule in schedules %}
            <div class="schedule-item {% if schedule.taken %}taken{% elif schedule.skipped %}skipped{% endif %}">
                <div class="schedule-time">
                    <div class="schedule-hour">{{ schedule.scheduled_time.strftime('%I:%M') }}</div>
                    <div class="schedule-period">{{ schedule.scheduled_time.strftime('%p') }}</div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">
                        {{ schedule.scheduled_time.strftime('%b %d') }}
                    </div>
                </div>
                <div class="schedule-info">
                    <div class="schedule-medicine">{{ schedule.medicine.name }}</div>
                    <div class="schedule-dosage">{{ schedule.medicine.dosage }}</div>
                    {% if schedule.medicine.instructions %}
                    <div class="schedule-dosage">{{ schedule.medicine.instructions }}</div>
                    {% endif %}
                    {% if schedule.taken %}
                    <div class="mt-1">
                        <span class="badge badge-success">Taken at {{ schedule.taken_at.strftime('%I:%M %p') }}</span>
                    </div>
                    {% elif schedule.skipped %}
                    <div class="mt-1">
                        <span class="badge badge-secondary">Skipped</span>
                    </div>
                    {% endif %}
                </div>
                {% if not schedule.taken and not schedule.skipped and schedule.scheduled_time <= now() + timedelta(hours=2) %}
                <div class="schedule-actions">
                    <button class="btn btn-success btn-sm btn-icon" onclick="markTaken({{ schedule.id }})">‚úì</button>
                    <button class="btn btn-secondary btn-sm btn-icon" onclick="markSkipped({{ schedule.id }})">‚úï</button>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üìÖ</div>
            <p class="empty-text">No upcoming doses scheduled</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem;">Upload a prescription to create schedule</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function markTaken(scheduleId) {
    fetch(`/api/schedule/${scheduleId}/mark-taken`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}

function markSkipped(scheduleId) {
    fetch(`/api/schedule/${scheduleId}/mark-skipped`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}
</script>
{% endblock %}
